{
  "hash": "6c1525f677b1bb0abad8b27ab7c5ecab",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Adherencia HM en el Centro de Simulación\"\nsubtitle: \"Ingesta de datos\"\nauthor: \n  - name: \"Mario Camacho\"\n    affiliation: \"Facultad de Medicina\"\n  - name: \"Fernando Neria\"\n    affiliation: \"Facultad de Medicina\"\ndate: \"2025-11-19\"\ndate-modified: \"2026-02-02\"\noutput:\n  html_document:\n     toc-title: \"Ingesta de datos\"\n     toc: true\n     toc_depth: 2\n---\n<button id=\"scroll-top\" onclick=\"window.scrollTo({top: 0, behavior: 'smooth'});\">\n  ↑ Inicio\n</button>\n- [Inicio](../index.html)\n- [Ingesta de datos](00_main.html)\n- [Resumen y gráficos descriptivos](01_eda.html)\n- [Análisis de la tasa de éxito en higiene de manos](02_estudio_adherencia.html)\n\n# Set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\nwd <- \"C:/Users/mario.camacho/OneDrive - UFV/Hospitales CAM\"\nwd <- file.path(wd, \"Sureste/Bea Isidoro 202511/20251118 Adherencia Higiene Manos en Centro de Simulación Clínica\")\nsetwd(wd)                       # cambia el WD de la sesión\nknitr::opts_knit$set(root.dir = wd)  # mantiene el WD en todos los chunks al render\nsource('scr/zz_libraries.R')\nsource('scr/zz_funciones.R')\n\n# Opciones globales de chunk\nopts_chunk$set(\n  fig.width = 6,\n  fig.height = 4,\n  fig.align = \"center\",\n  out.width = \"80%\",\n  fig.show = \"hold\"\n)\n\n# Espaciado entre imágenes en HTML\ncat(\"<style>img { margin-bottom: 20px; }</style>\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<style>img { margin-bottom: 20px; }</style>\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\noptions(skimr.max_char = 100) # Para que no trunque los nombres de los factores\n```\n:::\n\n\n# Ingesta\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Al hacer render y un nuevo hedline, se crea un nu\ndata_raw <- read_excel(\"raw/20251118 Base datos Registros HM UFV.xlsx\", sheet = \"Registros HM\")\ndata <- data_raw\n# View(data)\n# View(data |> filter(id_video=='v153738-578'), title = \"id_video v153738-578\")\n```\n:::\n\n\n# Evaluación de medidas repetidas\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Registros por cada id\nid_count <- data |>\n  group_by(id) |>\n  summarise(n_registros = n(), .groups = \"drop\")\n\nunicos <- sum(id_count$n_registros == 1)\nmultiples <- sum(id_count$n_registros > 1)\n\nif (multiples == 0) {\n  print(\"Solo un registro por cada id en la base de datos\")\n} else {\n  print(paste(unicos, \"id tienen un único registro y\", multiples, \"id tienen más de un registro\"))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Solo un registro por cada id en la base de datos\"\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\n# Cursos por cada id\nid_curso_count <- data |>\n  group_by(id,curso) |>\n  summarise(n_registros = n(), .groups = \"drop\")\n\nunicos <- sum(id_curso_count$n_registros == 1)\nmultiples <- sum(id_curso_count$n_registros > 1)\n\nif (multiples == 0) {\n  print(\"Ningún alumno (id) ha sido evaluado en más de un curso\")\n} else {\n  print(paste(unicos, \"alumnos (id) han sido evaluados en un único curso y\", multiples, \"alumnos han sido evaluados en más de una vez\"))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Ningún alumno (id) ha sido evaluado en más de un curso\"\n```\n\n\n:::\n:::\n\n\n# Formatos\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\n### Solo para hacer pruebas con las continuas\n# data <- data |>  mutate(guantes = as.numeric(guantes == \"SI\"))\n####\n\nvar <- c('curso','escenario','situacion','indicacion','accion','guantes')\n\ndata[var] |> mutate(across(everything(), factor)) |> summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                             curso                      escenario               situacion   \n 4º (post-formación corto plazo): 73   Box                   :572   Entrada          :  12  \n 4º (pre-formación)             :371   Consulta              :325   Punto de atención:1130  \n 5º (post-formación largo plazo):698   Procedimiento invasivo:245                           \n                                                                                            \n                                                                                            \n                                            indicacion           accion    guantes  \n Antes de realizar una técnica aséptica          :136   Agua + Jabón:  9   NO:1021  \n Antes del contacto con el paciente              :472   No HM       :885   SI: 121  \n Después del contacto con el entorno del paciente: 41   PBA         :248            \n Después del contacto con el paciente            :355                               \n Después del riesgo de exposición a fluidos      :138                               \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ndata <- data |> mutate(across(var[1], ~factor(., levels = c(\"4º (pre-formación)\", \"4º (post-formación corto plazo)\", \"5º (post-formación largo plazo)\"),\n                                               ordered = TRUE)))\ndata <- data |> mutate(across(var[4], ~factor(., levels = c(\"Antes de realizar una técnica aséptica\",\n                                                             \"Antes del contacto con el paciente\",\n                                                             \"Después del contacto con el entorno del paciente\",\n                                                             \"Después del contacto con el paciente\",\n                                                             \"Después del riesgo de exposición a fluidos\"),\n                                               labels = c(\"M1\", \"M2\", \"M3\", \"M4\", \"M5\"),\n                                               ordered = FALSE))) # Puse TRUE pero creo que es FALSE\n\ndata[var] |> select(where(is.character)) |> mutate(across(where(is.character), factor)) |> summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  escenario               situacion             accion    guantes  \n Box                   :572   Entrada          :  12   Agua + Jabón:  9   NO:1021  \n Consulta              :325   Punto de atención:1130   No HM       :885   SI: 121  \n Procedimiento invasivo:245                            PBA         :248            \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ndata <- data |> mutate(across(any_of(var) & where(is.character), factor))\n\n# View(data |> filter(id_video=='v153738-578'), title = \"id_video v153738-578\")\n\ndata <- data |> select(-all_of(intersect(\"id\", names(data))))\ndata <- data |> select(-all_of(intersect(\"id_video\", names(data)))) # OJO QUE SE PODRÍA USAR EL VÍDEO COMO UN FACTOR ALEATORIO\n# (cada vídeo es revisado en por gente diferente, por gente diferente... y eso afectase a la evaluación - no sé si evaluar HM es muy subjetivo o no)\n\ndata |> str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [1,142 × 6] (S3: tbl_df/tbl/data.frame)\n $ curso     : Ord.factor w/ 3 levels \"4º (pre-formación)\"<..: 1 1 1 1 1 1 1 1 1 1 ...\n $ escenario : Factor w/ 3 levels \"Box\",\"Consulta\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ situacion : Factor w/ 2 levels \"Entrada\",\"Punto de atención\": 2 2 2 2 2 2 2 2 2 2 ...\n $ indicacion: Factor w/ 5 levels \"M1\",\"M2\",\"M3\",..: 2 4 2 4 2 4 2 4 2 4 ...\n $ accion    : Factor w/ 3 levels \"Agua + Jabón\",..: 2 2 2 2 2 2 2 2 2 2 ...\n $ guantes   : Factor w/ 2 levels \"NO\",\"SI\": 1 1 1 1 1 1 1 1 1 1 ...\n```\n\n\n:::\n:::\n\n\n# Variable respuesta\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\ncat(\"La variable respuesta 'oportunidad de HM realizada' no depende del producto y ya se ha tenido en cuenta la variable 'guantes'.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLa variable respuesta 'oportunidad de HM realizada' no depende del producto y ya se ha tenido en cuenta la variable 'guantes'.\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ntable(data$guantes, data$accion)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    \n     Agua + Jabón No HM PBA\n  NO            8   788 225\n  SI            1    97  23\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\ndata <- data |> mutate(accion = factor(if_else(accion=='No HM', 'No HM', 'HM'), levels = c('No HM', 'HM')))\n\ntable(data$guantes, data$accion)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    \n     No HM  HM\n  NO   788 233\n  SI    97  24\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\n# Definir los colores fijos\ncolores_accion <- c(\"HM\" = \"green\", \"No HM\" = \"yellow\")\n# Sobrescribir las escalas por defecto\n# update_geom_defaults(\"bar\", list(fill = colores_accion[\"No HM\"]))\n# update_geom_defaults(\"point\", list(color = colores_accion[\"No HM\"]))\n# Función que aplica la escala automáticamente\nescala_accion <- function() {\n  list(\n    scale_fill_manual(values = colores_accion),\n    scale_color_manual(values = colores_accion)\n  )\n}\n```\n:::\n\n\n# Guardar\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\nsaveRDS(list(data = data, data_raw = data_raw), \"raw/data.RDA\")\nsaveRDS(list(colores_accion = colores_accion, escala_accion = escala_accion), \"raw/HM_colores.RDA\")\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}