{"title":"Adherencia HM en el Centro de Simulación","markdown":{"yaml":{"title":"Adherencia HM en el Centro de Simulación","subtitle":"Prevalencia de la higiene de manos","author":[{"name":"Mario Camacho","affiliation":"Facultad de Medicina"},{"name":"Fernando Neria","affiliation":"Facultad de Medicina"}],"date":"2026-01-07","date-modified":"last-modified","output":{"html_document":{"toc-title":"Ingesta de datos","toc":true,"toc_depth":2}}},"headingText":"Ocupa todo el ancho del chunk","containsRefs":false,"markdown":"\n<button id=\"scroll-top\" onclick=\"window.scrollTo({top: 0, behavior: 'smooth'});\">\n  ↑ Inicio\n</button>\n- [Inicio](../index.html)\n- [Ingesta de datos](00_main.html)\n- [Resumen y gráficos descriptivos](01_eda.html)\n- [Análisis estadística sobre la adherencia de la higiene de manos](scr/02_estudio_adherencia.html)\n\n\n```{r Set up, include=FALSE}\nwd <- \"C:/Users/mario.camacho/OneDrive - UFV/Hospitales CAM\"\nwd <- file.path(wd, \"Sureste/Bea Isidoro 202511/20251118 Adherencia Higiene Manos en Centro de Simulación Clínica\")\nsetwd(wd)                       # cambia el WD de la sesión\nknitr::opts_knit$set(root.dir = wd)  # mantiene el WD en todos los chunks al render\nsource('scr/zz_libraries.R')\nsource('scr/zz_funciones.R')\noptions(error = NULL)  # Resetear manejo de errores\noptions(warning = NULL)  # Resetear manejo de warnings\n\nknitr::opts_chunk$set(echo = FALSE)\nknitr::opts_chunk$set(comment = NA)\noptions(tibble.width = Inf)\nknitr::opts_chunk$set(\n  out.width = \"120%\",\n  echo = FALSE,\n  comment = NA,\n  fig.width = 6,\n  fig.height = 4,\n  fig.align = \"center\",\n  fig.show = \"hold\"\n)\n\n# Espaciado entre imágenes en HTML\ncat(\"<style>img { margin-bottom: 20px; }</style>\")\n\noptions(skimr.max_char = 100) # Para que no trunque los nombres de los factores\n\ndata_rda <- readRDS(\"raw/data.RDA\")\ndata <- data_rda$data\ndata_raw <- data_rda$data_raw\n\ndata <- data |> mutate(accion = factor(if_else(accion=='No HM', 0, 1)))\ndata <- data |> mutate(tiempo = factor(if_else(str_detect(curso, \"pre\"), 'pre-formación', 'post-formación')))\n\nic_exacto_clopper_Pearson <- function(x, n, alpha = 0.05) {\n  ic_CP <- binom.test(x, n, conf.level = 1 - alpha)\n  return(c(x/n, ic_CP$conf.int))\n}\n\n```\n```{r Categorizar p-valor, include=FALSE}\ncategorizar_p <- function(p) {\n  if (p < 0.001) {\n    \"<0.001\"\n  } else if (p < 0.01) {\n    \"<0.01\"\n  } else if (p < 0.05) {\n    \"<0.05\"\n  } else if (p < 0.1) {\n    \"<0.1\"\n  } else {\n    sprintf(\"%.3f\", p)\n  }\n}\n\n```\n```{r Bonferroni funcion, include=FALSE}\ncomparar_pares <- function(tabla_contingencia, alpha=0.05) {\n  niveles <- rownames(tabla_contingencia)\n  n_pares <- choose(length(niveles), 2)\n  resultados <- data.frame()\n  \n  for(i in 1:(length(niveles)-1)) {\n    for(j in (i+1):length(niveles)) {\n      # Crear subtabla para el par\n      subtabla <- tabla_contingencia[c(i, j), ]\n      prueba <- prop.test(subtabla)\n      \n      resultados <- rbind(resultados, data.frame(\n        `Grupo 1` = niveles[i],\n        `Grupo 2` = niveles[j],\n        `Prev 1` = round(subtabla[1, \"1\"]/sum(subtabla[1, ]), 3),\n        `Prev 2` = round(subtabla[2, \"1\"]/sum(subtabla[2, ]), 3),\n        # Diferencia = round(abs(subtabla[1, \"1\"]/sum(subtabla[1, ]) - \n        #                          subtabla[2, \"1\"]/sum(subtabla[2, ])), 3),\n        # p_valor = prueba$p.value,\n        p_valor = categorizar_p(p.adjust(prueba$p.value, method = \"bonferroni\", n = n_pares))\n        # Significativo = ifelse(prueba$p.value < alpha, ifelse(p.adjust(prueba$p.value, method = \"bonferroni\", n = n_pares) < alpha, \"*\", \"\"), \"\")\n        \n      ))\n    }\n  }\n  return(resultados)\n}\n\n```\n```{r Gráfico de barras de la prevalencia e IC 95 %, include=FALSE}\nplot_p3 <- function(prevalencia, ics) {\n  \n  ics$Curso <- factor(rownames(ics), levels = rownames(ics))\n  \n  p3 <-\n    ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n    geom_col(fill = \"steelblue\", width = 0.7) +\n    geom_errorbar(\n      data = ics,\n      aes(x = Curso, ymin = IC_95_inf, ymax = IC_95_sup),\n      width = 0.15,\n      inherit.aes = FALSE\n    ) +\n    geom_point(\n      data = ics,\n      aes(x = Curso, y = Prevalencia),\n      size = 2,\n      inherit.aes = FALSE\n    ) +\n    geom_text(\n      aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n      vjust = -0.5,\n      hjust = 1.4\n    ) +\n    labs(\n      x = \"Curso\",\n      y = \"Prevalencia\",\n      title = \"Prevalencia de higiene de manos con IC del 95 %\"\n    ) +\n    scale_y_continuous(\n      labels = scales::percent_format(),\n      limits = c(0, max(ics$IC_95_sup, na.rm = TRUE) * 1.2)\n    ) +\n    scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n    theme_minimal() +\n    theme(axis.text.x = element_text(size = 8),\n          panel.grid = element_blank())\n  \n  return(p3)\n}\n```\n\n# Prevalencia de HM en cada curso\n\n```{r include=FALSE}\ntabla_prev <- table(data$curso, data$accion)\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n```\n```{r include=TRUE}\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\ncat(\"Prevalencias con intervalos de confianza del 95%:\\n\", capture.output(round(ics, 3)), sep=\"\\n\")\n\n# Comparación por pares con corrección de Bonferroni\ncat(\"Comparamos la prevalencia por curso.\\nCalculamos la diferencia de proporciones y obtenemos el p-valor ajustado por Bonferroni.\")\n(comparaciones <- comparar_pares(tabla_prev))\n\np1 <-\n  ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n  geom_col(fill = \"steelblue\", width = 0.7) +\n  geom_text(\n    aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n    vjust = -0.5\n  ) +\n  labs(\n    x = \"Curso\",\n    y = \"Prevalencia\",\n    title = \"Prevalencia de higiene de manos por curso\"\n  ) +\n  ylim(0, max(prevalencia$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(prevalencia$Prevalencia) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n\nics$Curso <- factor(rownames(ics), levels = rownames(ics))\np2 <-\nggplot(ics, aes(x = Curso, y = Prevalencia)) +\n  geom_point(size = 2) +\n  geom_errorbar(aes(ymin = IC_95_inf, ymax = IC_95_sup), \n                width = 0.1) +\n  labs(x = \"Curso\", y = \"Prevalenciade HM\", \n       title = \"Prevalencia de la HM con IC del 95 %\") +\n  ylim(0, max(ics$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(ics$IC_95_sup) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n# grid::grid.newpage()\n# grid::grid.draw(p1 + p2 + patchwork::plot_layout(ncol = 2))\n\np3 <-\n  ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n  geom_col(fill = \"steelblue\", width = 0.7) +\n  geom_errorbar(\n    data = ics,\n    aes(x = Curso, ymin = IC_95_inf, ymax = IC_95_sup),\n    width = 0.15,\n    inherit.aes = FALSE\n  ) +\n  geom_point(\n    data = ics,\n    aes(x = Curso, y = Prevalencia),\n    size = 2,\n    inherit.aes = FALSE\n  ) +\n  geom_text(\n    aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n    vjust = -0.5,\n    hjust = 1.4\n  ) +\n  labs(\n    x = \"Curso\",\n    y = \"Prevalencia\",\n    title = \"Prevalencia de higiene de manos con IC del 95 %\"\n  ) +\n  ylim(0, max(ics$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(ics$IC_95_sup) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n\np3 <- plot_p3(prevalencia,ics)\nknitr::knit_print(p3)\ncat(\"Se puede separar el gráfico anterior en dos si fuera de interes\\n(barras apiladas en un gráfico e intervalos de confianza en otro)\")\n```\n\n# Prevalencia de HM en cada curso (filtrado por escenario)\nSe debe tener en cuenta la distribución entre curso y escenario.\n\n```{r}\nresults <- readRDS(\"raw/results_curso_escenario.rds\")\nprint(results[[1]]$plot)\n```\n\nEl único escenario donde se puede medir el efecto (a corto y largo plazo) es CONSULTA.\n\nVolvemos a comperar la prevalencia de la HM entre cursos,  \ncalculamos la diferencia de proporciones y obtenemos el p-valor ajustado por Bonferroni.\n\n::: {.callout-note}\n**Box**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Box')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n```\n\nCalculamos la diferencia de la prevalencia y obtenemos el p-valor ajustado por Bonferroni.\n\n```{r}\n(comparaciones <- comparar_pares(tabla_prev))\n\np3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Box\")\nknitr::knit_print(p3)\n```\n\n:::\n::: {.callout-note}\n**Consulta**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Consulta')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n```\n\nCalculamos la diferencia de la prevalencia y obtenemos el p-valor ajustado por Bonferroni.\n\n```{r}\n(comparaciones <- comparar_pares(tabla_prev))\n\np3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Consulta\")\nknitr::knit_print(p3)\n```\n\n:::\n::: {.callout-note}\n**Procedimiento invasivo**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Procedimiento invasivo')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\n(prevalencia_niveles <- prop.table(tabla_prev))\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- c(tabla_prev[2]/sum(tabla_prev), binom.test(tabla_prev[2], sum(tabla_prev), conf.level = 1 - 0.05)$conf.int[1:2]) |> as_data_frame() |> t()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n\n# p3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Consulta\")\n# knitr::knit_print(p3)\n```\n\n:::\n# Otra cosa\n\n```{r}\ntbl_strata(data, strata = indicacion, .tbl_fun = \n             ~ .x |>\n             tbl_summary(by = curso, missing = \"no\", value = list(accion~1), percent = 'row', include = c(accion)) |>\n             add_n() |> add_p())\n\ntbl_strata(data, strata = escenario, .tbl_fun = \n             ~ .x |>\n             tbl_summary(by = curso, missing = \"no\", value = list(accion~1), percent = 'column', include = c(accion)) |>\n             add_n() |> add_p())\n```\n\n# Modelos\nComparar curso a curso: factor nominal\nComparar el efecto tiempo: factor ordinal\nEfecto de curso, indicación y escenario sobre la higiene de manos.\n\nConsiderando el curso como ORDINAL\n\n```{r}\nm1 <- glm(accion ~ curso + indicacion + escenario, data = data, family = binomial(link = 'logit'))\ntbl_regression(m1, exponentiate = TRUE)\nsummary(m1)\n```\n\nConsiderando el curso como NOMINAL\n\n```{r}\ndata <- data |> mutate(curso = factor(curso, levels = levels(curso), ordered = FALSE))\nm2 <- glm(accion ~ curso + indicacion + escenario, data = data, family = binomial(link = 'logit'))\ntbl_regression(m2, exponentiate = TRUE)\nsummary(m2)\n```\n\nEfecto de curso, indicación y SOLO en el escenario de CONSULTA\n\n```{r}\nm3 <- glm(accion ~ curso + indicacion, data = data |> filter(escenario=='Consulta'), family = binomial(link = 'logit'))\ntbl_regression(m3, exponentiate = TRUE)\nsummary(m3)\n```\n","srcMarkdownNoYaml":"\n<button id=\"scroll-top\" onclick=\"window.scrollTo({top: 0, behavior: 'smooth'});\">\n  ↑ Inicio\n</button>\n- [Inicio](../index.html)\n- [Ingesta de datos](00_main.html)\n- [Resumen y gráficos descriptivos](01_eda.html)\n- [Análisis estadística sobre la adherencia de la higiene de manos](scr/02_estudio_adherencia.html)\n\n\n```{r Set up, include=FALSE}\nwd <- \"C:/Users/mario.camacho/OneDrive - UFV/Hospitales CAM\"\nwd <- file.path(wd, \"Sureste/Bea Isidoro 202511/20251118 Adherencia Higiene Manos en Centro de Simulación Clínica\")\nsetwd(wd)                       # cambia el WD de la sesión\nknitr::opts_knit$set(root.dir = wd)  # mantiene el WD en todos los chunks al render\nsource('scr/zz_libraries.R')\nsource('scr/zz_funciones.R')\noptions(error = NULL)  # Resetear manejo de errores\noptions(warning = NULL)  # Resetear manejo de warnings\n\nknitr::opts_chunk$set(echo = FALSE)\nknitr::opts_chunk$set(comment = NA)\noptions(tibble.width = Inf)\n# Ocupa todo el ancho del chunk\nknitr::opts_chunk$set(\n  out.width = \"120%\",\n  echo = FALSE,\n  comment = NA,\n  fig.width = 6,\n  fig.height = 4,\n  fig.align = \"center\",\n  fig.show = \"hold\"\n)\n\n# Espaciado entre imágenes en HTML\ncat(\"<style>img { margin-bottom: 20px; }</style>\")\n\noptions(skimr.max_char = 100) # Para que no trunque los nombres de los factores\n\ndata_rda <- readRDS(\"raw/data.RDA\")\ndata <- data_rda$data\ndata_raw <- data_rda$data_raw\n\ndata <- data |> mutate(accion = factor(if_else(accion=='No HM', 0, 1)))\ndata <- data |> mutate(tiempo = factor(if_else(str_detect(curso, \"pre\"), 'pre-formación', 'post-formación')))\n\nic_exacto_clopper_Pearson <- function(x, n, alpha = 0.05) {\n  ic_CP <- binom.test(x, n, conf.level = 1 - alpha)\n  return(c(x/n, ic_CP$conf.int))\n}\n\n```\n```{r Categorizar p-valor, include=FALSE}\ncategorizar_p <- function(p) {\n  if (p < 0.001) {\n    \"<0.001\"\n  } else if (p < 0.01) {\n    \"<0.01\"\n  } else if (p < 0.05) {\n    \"<0.05\"\n  } else if (p < 0.1) {\n    \"<0.1\"\n  } else {\n    sprintf(\"%.3f\", p)\n  }\n}\n\n```\n```{r Bonferroni funcion, include=FALSE}\ncomparar_pares <- function(tabla_contingencia, alpha=0.05) {\n  niveles <- rownames(tabla_contingencia)\n  n_pares <- choose(length(niveles), 2)\n  resultados <- data.frame()\n  \n  for(i in 1:(length(niveles)-1)) {\n    for(j in (i+1):length(niveles)) {\n      # Crear subtabla para el par\n      subtabla <- tabla_contingencia[c(i, j), ]\n      prueba <- prop.test(subtabla)\n      \n      resultados <- rbind(resultados, data.frame(\n        `Grupo 1` = niveles[i],\n        `Grupo 2` = niveles[j],\n        `Prev 1` = round(subtabla[1, \"1\"]/sum(subtabla[1, ]), 3),\n        `Prev 2` = round(subtabla[2, \"1\"]/sum(subtabla[2, ]), 3),\n        # Diferencia = round(abs(subtabla[1, \"1\"]/sum(subtabla[1, ]) - \n        #                          subtabla[2, \"1\"]/sum(subtabla[2, ])), 3),\n        # p_valor = prueba$p.value,\n        p_valor = categorizar_p(p.adjust(prueba$p.value, method = \"bonferroni\", n = n_pares))\n        # Significativo = ifelse(prueba$p.value < alpha, ifelse(p.adjust(prueba$p.value, method = \"bonferroni\", n = n_pares) < alpha, \"*\", \"\"), \"\")\n        \n      ))\n    }\n  }\n  return(resultados)\n}\n\n```\n```{r Gráfico de barras de la prevalencia e IC 95 %, include=FALSE}\nplot_p3 <- function(prevalencia, ics) {\n  \n  ics$Curso <- factor(rownames(ics), levels = rownames(ics))\n  \n  p3 <-\n    ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n    geom_col(fill = \"steelblue\", width = 0.7) +\n    geom_errorbar(\n      data = ics,\n      aes(x = Curso, ymin = IC_95_inf, ymax = IC_95_sup),\n      width = 0.15,\n      inherit.aes = FALSE\n    ) +\n    geom_point(\n      data = ics,\n      aes(x = Curso, y = Prevalencia),\n      size = 2,\n      inherit.aes = FALSE\n    ) +\n    geom_text(\n      aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n      vjust = -0.5,\n      hjust = 1.4\n    ) +\n    labs(\n      x = \"Curso\",\n      y = \"Prevalencia\",\n      title = \"Prevalencia de higiene de manos con IC del 95 %\"\n    ) +\n    scale_y_continuous(\n      labels = scales::percent_format(),\n      limits = c(0, max(ics$IC_95_sup, na.rm = TRUE) * 1.2)\n    ) +\n    scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n    theme_minimal() +\n    theme(axis.text.x = element_text(size = 8),\n          panel.grid = element_blank())\n  \n  return(p3)\n}\n```\n\n# Prevalencia de HM en cada curso\n\n```{r include=FALSE}\ntabla_prev <- table(data$curso, data$accion)\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n```\n```{r include=TRUE}\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\ncat(\"Prevalencias con intervalos de confianza del 95%:\\n\", capture.output(round(ics, 3)), sep=\"\\n\")\n\n# Comparación por pares con corrección de Bonferroni\ncat(\"Comparamos la prevalencia por curso.\\nCalculamos la diferencia de proporciones y obtenemos el p-valor ajustado por Bonferroni.\")\n(comparaciones <- comparar_pares(tabla_prev))\n\np1 <-\n  ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n  geom_col(fill = \"steelblue\", width = 0.7) +\n  geom_text(\n    aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n    vjust = -0.5\n  ) +\n  labs(\n    x = \"Curso\",\n    y = \"Prevalencia\",\n    title = \"Prevalencia de higiene de manos por curso\"\n  ) +\n  ylim(0, max(prevalencia$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(prevalencia$Prevalencia) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n\nics$Curso <- factor(rownames(ics), levels = rownames(ics))\np2 <-\nggplot(ics, aes(x = Curso, y = Prevalencia)) +\n  geom_point(size = 2) +\n  geom_errorbar(aes(ymin = IC_95_inf, ymax = IC_95_sup), \n                width = 0.1) +\n  labs(x = \"Curso\", y = \"Prevalenciade HM\", \n       title = \"Prevalencia de la HM con IC del 95 %\") +\n  ylim(0, max(ics$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(ics$IC_95_sup) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n# grid::grid.newpage()\n# grid::grid.draw(p1 + p2 + patchwork::plot_layout(ncol = 2))\n\np3 <-\n  ggplot(prevalencia, aes(x = Curso, y = Prevalencia)) +\n  geom_col(fill = \"steelblue\", width = 0.7) +\n  geom_errorbar(\n    data = ics,\n    aes(x = Curso, ymin = IC_95_inf, ymax = IC_95_sup),\n    width = 0.15,\n    inherit.aes = FALSE\n  ) +\n  geom_point(\n    data = ics,\n    aes(x = Curso, y = Prevalencia),\n    size = 2,\n    inherit.aes = FALSE\n  ) +\n  geom_text(\n    aes(label = paste0(round(Prevalencia * 100, 1), \"%\")),\n    vjust = -0.5,\n    hjust = 1.4\n  ) +\n  labs(\n    x = \"Curso\",\n    y = \"Prevalencia\",\n    title = \"Prevalencia de higiene de manos con IC del 95 %\"\n  ) +\n  ylim(0, max(ics$Prevalencia) * 1.2) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, max(ics$IC_95_sup) * 1.2)) +\n  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(size = 8), panel.grid = element_blank())\n\np3 <- plot_p3(prevalencia,ics)\nknitr::knit_print(p3)\ncat(\"Se puede separar el gráfico anterior en dos si fuera de interes\\n(barras apiladas en un gráfico e intervalos de confianza en otro)\")\n```\n\n# Prevalencia de HM en cada curso (filtrado por escenario)\nSe debe tener en cuenta la distribución entre curso y escenario.\n\n```{r}\nresults <- readRDS(\"raw/results_curso_escenario.rds\")\nprint(results[[1]]$plot)\n```\n\nEl único escenario donde se puede medir el efecto (a corto y largo plazo) es CONSULTA.\n\nVolvemos a comperar la prevalencia de la HM entre cursos,  \ncalculamos la diferencia de proporciones y obtenemos el p-valor ajustado por Bonferroni.\n\n::: {.callout-note}\n**Box**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Box')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n```\n\nCalculamos la diferencia de la prevalencia y obtenemos el p-valor ajustado por Bonferroni.\n\n```{r}\n(comparaciones <- comparar_pares(tabla_prev))\n\np3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Box\")\nknitr::knit_print(p3)\n```\n\n:::\n::: {.callout-note}\n**Consulta**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Consulta')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\nprevalencia_niveles <- prop.table(tabla_prev, margin = 1)[, \"1\"]\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- t(apply(tabla_prev, 1, function(x) ic_exacto_clopper_Pearson(x[\"1\"], sum(x)))) |> as.data.frame()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n```\n\nCalculamos la diferencia de la prevalencia y obtenemos el p-valor ajustado por Bonferroni.\n\n```{r}\n(comparaciones <- comparar_pares(tabla_prev))\n\np3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Consulta\")\nknitr::knit_print(p3)\n```\n\n:::\n::: {.callout-note}\n**Procedimiento invasivo**\n\n```{r}\ndata_esc <- subset(data, escenario == 'Procedimiento invasivo')\ntabla_prev <- table(data_esc$curso, data_esc$accion)\ntabla_prev <- tabla_prev[rowSums(tabla_prev) > 1, ]\n(prevalencia_niveles <- prop.table(tabla_prev))\nprevalencia <- data.frame(Curso = factor(names(prevalencia_niveles), levels = names(prevalencia_niveles)),\n                          Prevalencia = as.numeric(prevalencia_niveles))\n\nics <- c(tabla_prev[2]/sum(tabla_prev), binom.test(tabla_prev[2], sum(tabla_prev), conf.level = 1 - 0.05)$conf.int[1:2]) |> as_data_frame() |> t()\ncolnames(ics) <- c(\"Prevalencia\", \"IC_95_inf\", \"IC_95_sup\")\n```\n\nPrevalencias con intervalos de confianza del 95%:\n\n```{r}\n(round(ics, 3))\n\n# p3 <- plot_p3(prevalencia,ics) + labs(subtitle = \"Escenario: Consulta\")\n# knitr::knit_print(p3)\n```\n\n:::\n# Otra cosa\n\n```{r}\ntbl_strata(data, strata = indicacion, .tbl_fun = \n             ~ .x |>\n             tbl_summary(by = curso, missing = \"no\", value = list(accion~1), percent = 'row', include = c(accion)) |>\n             add_n() |> add_p())\n\ntbl_strata(data, strata = escenario, .tbl_fun = \n             ~ .x |>\n             tbl_summary(by = curso, missing = \"no\", value = list(accion~1), percent = 'column', include = c(accion)) |>\n             add_n() |> add_p())\n```\n\n# Modelos\nComparar curso a curso: factor nominal\nComparar el efecto tiempo: factor ordinal\nEfecto de curso, indicación y escenario sobre la higiene de manos.\n\nConsiderando el curso como ORDINAL\n\n```{r}\nm1 <- glm(accion ~ curso + indicacion + escenario, data = data, family = binomial(link = 'logit'))\ntbl_regression(m1, exponentiate = TRUE)\nsummary(m1)\n```\n\nConsiderando el curso como NOMINAL\n\n```{r}\ndata <- data |> mutate(curso = factor(curso, levels = levels(curso), ordered = FALSE))\nm2 <- glm(accion ~ curso + indicacion + escenario, data = data, family = binomial(link = 'logit'))\ntbl_regression(m2, exponentiate = TRUE)\nsummary(m2)\n```\n\nEfecto de curso, indicación y SOLO en el escenario de CONSULTA\n\n```{r}\nm3 <- glm(accion ~ curso + indicacion, data = data |> filter(escenario=='Consulta'), family = binomial(link = 'logit'))\ntbl_regression(m3, exponentiate = TRUE)\nsummary(m3)\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":{"html_document":{"toc-title":"Ingesta de datos","toc":true,"toc_depth":2}},"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","self-contained":true,"toc":true,"css":["../styles.css"],"output-file":"02_prevalencia_por_curso.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","navbar":{"left":[{"href":"index.html","text":"Inicio"},{"href":"../../00_Documentación/20240830 CRD_HM UFV.pdf","text":"Ingesta de datos"},{"href":"00_main.html","text":"Ingesta de datos"},{"href":"scr/00_main.html","text":"Librerías"}]},"toc-location":"left","toc-width":"200px","toc-expand":true,"page-layout":"full","editor":"visual","knitr":{"opts_chunk":{"code-fold":false,"R.options":{"width":110},"fig.align":"center"}},"color-scheme":"dark","theme":{"light":"default","dark":"darkly"},"title":"Adherencia HM en el Centro de Simulación","subtitle":"Prevalencia de la higiene de manos","author":[{"name":"Mario Camacho","affiliation":"Facultad de Medicina"},{"name":"Fernando Neria","affiliation":"Facultad de Medicina"}],"date":"2026-01-07","date-modified":"last-modified"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}